
<center>
<script src="https://d3js.org/d3.v4.min.js"></script>
<svg id="mainSVG" width=350 height=350 viewBox="0 0 100 100" >
 <rect width="100%" height="100%" fill="#F8F8F0" /> 
</svg><br>
<input type="checkbox" name="form_txt_done" id="form_txt_done" value=1 style='visibility:hidden'>
<input name="form_txt_selectEdges" id="form_txt_selectEdges" value="" style='visibility:hidden'>

<style>
.outterEdge:hover .highlight {
   stroke-opacity:1 !important;
}
</style>

<script>
var n={{graphSize}};
var edges={{edges}};
    console.log(n);
    console.log(edges);
var color = d3.scaleLinear()
    .domain([0, n-1])
    .range(["#CFC", "#CCF"]);
    
var vertices = [];
for (var i=0; i<n; i++) {
    vertices.push({i:i, x:Math.random()*90+5, y:Math.random()*90+5});
}

var selectedEdges=  d3.select("#form_txt_selectEdges").property("value"); 
edges=edges.map(function(e){
    var d={source:vertices[e[0]], target:vertices[e[1]], select:false};
    d.str='('+e.join(',')+')';
    d.select=selectedEdges.indexOf(d.str)!=-1;
    return d;})
draw();
    
    
function evaluate(i){
  d3.select("#vertex0").classed("badVertex", true)     
  d3.select("#vertex"+i).classed("badVertex",true)
  updateVertexStyle();
  
}
function clearEvaluate() {
  d3.selectAll(".badVertex").classed("badVertex", false);
  updateVertexStyle();
}

function updateVertexStyle(){
  d3.selectAll(".vertex")
    .style("fill", function(d){return color(d.i)})  
    .style("stroke-width", "0.5")
    .style("stroke", "black")
    .attr("r", 3)
  d3.selectAll(".badVertex")
    .style('stroke-width', '1px')
    .style('stroke', 'black')
    .style('fill', 'red');
}
function draw() {
  
     
  var link=function(e){
    return "M "+e.source.x+","+e.source.y+" L"+e.target.x+","+e.target.y;
  }
  var drag = d3.drag().on("drag", dragged);
  
  function inBounds(z) {
    return z<5?5:(z>95?95:z)
  }
  function dragged(d) {
      d.x=inBounds(d3.event.x);
      d.y=inBounds(d3.event.y);
      update();
  }
  function edgeClick(d) {
     d.select =!d.select;
     
     var sel=edges.filter(function(d){return d.select})
             .map(function(d){return "("+d.source.i+","+d.target.i+")"})
             .join(",");
   
     d3.select("#form_txt_selectEdges").property("value", sel); 
     clearEvaluate() 
     update();
  }
  function update() {
     d3
      .selectAll(".vertex")
      .attr("cx", function(d){return d.x})
      .attr("cy", function(d){return d.y});  
    d3
      .selectAll(".edge")
      .attr("d", link);
    d3
      .selectAll(".edge.highlight")
      .style("stroke-opacity", function(d){return d.select? 0.5 : 0.01})
      .style("stroke", function(d){return d.select? "#88F" : "yellow"})
  }
    
  d3.select("#mainSVG")
    .selectAll(".outterEdge")
    .data(edges)
    .enter()
    .append("g")
    .attr("id", function(d){return "edge"+d.source.i+"-"+d.target.i})
    .attr("class", function(d){return "outterEdge"})
    .on("click",edgeClick)
    .style("cursor", "pointer");
    
    
    
  d3.selectAll(".outterEdge")
    .append("path")
    .attr("class", function(d){return "edge highlight"})
    .attr("d", link)
    .style("fill", "none")
    .style("stroke-width", "4")
    
  d3.selectAll(".outterEdge")
    .append("path")
    .attr("class", function(d){return "edge show"})
    .attr("d", link)
    .style("stroke", "black")
    .style("fill", "none")
    
  d3.select("#mainSVG")
    .selectAll(".vertex")
    .data(vertices)
    .enter()
    .append("circle")
    .attr("id", function(d){return "vertex"+d.i})
    .attr("class", function(d){return "vertex"})
    .call(drag);
  updateVertexStyle();
  update();  

}
</script>
</center>